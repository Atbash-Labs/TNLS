
<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/"/>

    <title>Differences from Python &#8212; Atbash documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css"/>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/alabaster.css"/>
    <script data-url_root="../../../../../" id="documentation_options"
            src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html"/>
    <link rel="search" title="Search" href="../../../../../search.html"/>

    <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css"/>


    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9"/>

</head>
<body>


<div class="document">
    <div class="documentwrapper">
        <div class="bodywrapper">


            <div class="body" role="main">

                <section id="differences-from-python">
                    <span id="id1"></span>
                    <h1>Differences from Python<a class="headerlink" href="#differences-from-python"
                                                  title="Permalink to this heading">¶</a></h1>
                    <p>Mypyc aims to be sufficiently compatible with Python semantics so that
                        migrating code to mypyc often doesn’t require major code
                        changes. There are various differences to enable performance gains
                        that you need to be aware of, however.</p>
                    <p>This section documents notable differences from Python. We discuss
                        many of them also elsewhere, but it’s convenient to have them here in
                        one place.</p>
                    <section id="running-compiled-modules">
                        <h2>Running compiled modules<a class="headerlink" href="#running-compiled-modules"
                                                       title="Permalink to this heading">¶</a></h2>
                        <p>You can’t use <code class="docutils literal notranslate"><span class="pre">python3</span>
                            <span class="pre">&lt;module&gt;.py</span></code> or <code
                                class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span>
                            <span class="pre">&lt;module&gt;</span></code>
                            to run compiled modules. Use <code class="docutils literal notranslate"><span class="pre">python3</span>
                                <span class="pre">-c</span> <span class="pre">&quot;import</span> <span class="pre">&lt;module&gt;&quot;</span></code>
                            instead,
                            or write a wrapper script that imports your module.</p>
                        <p>As a side effect, you can’t rely on checking the <code
                                class="docutils literal notranslate"><span class="pre">__name__</span></code> attribute
                            in compiled
                            code, like this:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="k">if</span> <span
                                    class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span
                                    class="p">:</span>  <span class="c1"># Can&#39;t be used in compiled code</span>
    <span class="n">main</span><span class="p">()</span>
</pre>
                            </div>
                        </div>
                    </section>
                    <section id="type-errors-prevent-compilation">
                        <h2>Type errors prevent compilation<a class="headerlink" href="#type-errors-prevent-compilation"
                                                              title="Permalink to this heading">¶</a></h2>
                        <p>You can’t compile code that generates mypy type check errors. You can
                            sometimes ignore these with a <code class="docutils literal notranslate"><span
                                    class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code>
                            comment, but this can
                            result in bad code being generated, and it’s considered dangerous.</p>
                        <div class="admonition note">
                            <p class="admonition-title">Note</p>
                            <p>In the future, mypyc may reject <code class="docutils literal notranslate"><span
                                    class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code>
                                comments that
                                may be unsafe.</p>
                        </div>
                    </section>
                    <section id="runtime-type-checking">
                        <h2>Runtime type checking<a class="headerlink" href="#runtime-type-checking"
                                                    title="Permalink to this heading">¶</a></h2>
                        <p>Non-erased types in annotations will be type checked at runtime. For example,
                            consider this function:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="k">def</span> <span
                                    class="nf">twice</span><span class="p">(</span><span class="n">x</span><span
                                    class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span
                                    class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>
</pre>
                            </div>
                        </div>
                        <p>If you try to call this function with a <code class="docutils literal notranslate"><span
                                class="pre">float</span></code> or <code class="docutils literal notranslate"><span
                                class="pre">str</span></code> argument,
                            you’ll get a type error on the call site, even if the call site is not
                            being type checked:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="n">twice</span><span
                                    class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span
                                    class="c1"># OK</span>
<span class="n">twice</span><span class="p">(</span><span class="mf">2.2</span><span class="p">)</span>  <span
                                        class="c1"># TypeError</span>
<span class="n">twice</span><span class="p">(</span><span class="s2">&quot;blah&quot;</span><span
                                        class="p">)</span>  <span class="c1"># TypeError</span>
</pre>
                            </div>
                        </div>
                        <p>Also, values with <em>inferred</em> types will be type checked. For example,
                            consider a call to the stdlib function <code class="docutils literal notranslate"><span
                                    class="pre">socket.gethostname()</span></code> in
                            compiled code. This function is not compiled (no stdlib modules are
                            compiled with mypyc), but mypyc uses a <em>library stub file</em> to infer
                            the return type as <code class="docutils literal notranslate"><span
                                    class="pre">str</span></code>. Compiled code calling <code
                                    class="docutils literal notranslate"><span class="pre">gethostname()</span></code>
                            will fail with <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>
                            if <code class="docutils literal notranslate"><span class="pre">gethostname()</span></code>
                            would return an
                            incompatible value, such as <code class="docutils literal notranslate"><span class="pre">None</span></code>:
                        </p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socket</span>

<span class="c1"># Fail if returned value is not a str</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span
                                        class="n">gethostname</span><span class="p">()</span>
</pre>
                            </div>
                        </div>
                        <p>Note that <code class="docutils literal notranslate"><span
                                class="pre">gethostname()</span></code> is defined like this in the stub file for
                            <code class="docutils literal notranslate"><span class="pre">socket</span></code> (in
                            typeshed):</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gethostname</span><span
                                    class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span
                                    class="p">:</span> <span class="o">...</span>
</pre>
                            </div>
                        </div>
                        <p>Thus mypyc verifies that library stub files and annotations in
                            non-compiled code match runtime values. This adds an extra layer of
                            type safety.</p>
                        <p>Casts such as <code class="docutils literal notranslate"><span class="pre">cast(str,</span>
                            <span class="pre">x)</span></code> will also result in strict type
                            checks. Consider this example:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span
                                    class="kn">import</span> <span class="n">cast</span>
<span class="o">...</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span
                                        class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre>
                            </div>
                        </div>
                        <p>The last line is essentially equivalent to this Python code when compiled:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="k">if</span> <span
                                    class="ow">not</span> <span class="nb">isinstance</span><span
                                    class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">str</span><span
                                    class="p">):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span
                                        class="o">...</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
</pre>
                            </div>
                        </div>
                        <p>In interpreted mode <code class="docutils literal notranslate"><span class="pre">cast</span></code>
                            does not perform a runtime type check.</p>
                    </section>
                    <section id="native-classes">
                        <h2>Native classes<a class="headerlink" href="#native-classes"
                                             title="Permalink to this heading">¶</a></h2>
                        <p>Native classes behave differently from Python classes. See
                            <a class="reference internal" href="native_classes.html#native-classes"><span
                                    class="std std-ref">Native classes</span></a> for the details.</p>
                    </section>
                    <section id="primitive-types">
                        <h2>Primitive types<a class="headerlink" href="#primitive-types"
                                              title="Permalink to this heading">¶</a></h2>
                        <p>Some primitive types behave differently in compiled code to improve
                            performance.</p>
                        <p><code class="docutils literal notranslate"><span class="pre">int</span></code> objects use an
                            unboxed (non-heap-allocated) representation for small
                            integer values. A side effect of this is that the exact runtime type of
                            <code class="docutils literal notranslate"><span class="pre">int</span></code> values is
                            lost. For example, consider this simple function:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">first_int</span><span
                                    class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">List</span><span
                                    class="p">[</span><span class="nb">int</span><span class="p">])</span> <span
                                    class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span
                                        class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">first_int</span><span class="p">([</span><span
                                        class="kc">True</span><span class="p">]))</span>  <span class="c1"># Output is 1, instead of True!</span>
</pre>
                            </div>
                        </div>
                        <p><code class="docutils literal notranslate"><span class="pre">bool</span></code> is a subclass
                            of <code class="docutils literal notranslate"><span class="pre">int</span></code>, so the
                            above code is
                            valid. However, when the list value is converted to <code
                                    class="docutils literal notranslate"><span class="pre">int</span></code>, <code
                                    class="docutils literal notranslate"><span class="pre">True</span></code>
                            is converted to the corresponding <code class="docutils literal notranslate"><span
                                    class="pre">int</span></code> value, which is <code
                                    class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
                        <p>Note that integers still have an arbitrary precision in compiled code,
                            similar to normal Python integers.</p>
                        <p>Fixed-length tuples are unboxed, similar to integers. The exact type
                            and identity of fixed-length tuples is not preserved, and you can’t
                            reliably use <code class="docutils literal notranslate"><span class="pre">is</span></code>
                            checks to compare tuples that are used in compiled
                            code.</p>
                    </section>
                    <section id="early-binding">
                        <span id="id2"></span>
                        <h2>Early binding<a class="headerlink" href="#early-binding"
                                            title="Permalink to this heading">¶</a></h2>
                        <p>References to functions, types, most attributes, and methods in the
                            same <a class="reference internal" href="compilation_units.html#compilation-units"><span
                                    class="std std-ref">compilation unit</span></a> use <em>early binding</em>:
                            the target of the reference is decided at compile time, whenever
                            possible. This contrasts with normal Python behavior of <em>late
                                binding</em>, where the target is found by a namespace lookup at
                            runtime. Omitting these namespace lookups improves performance, but
                            some Python idioms don’t work without changes.</p>
                        <p>Note that non-final module-level variables still use late binding.
                            You may want to avoid these in very performance-critical code.</p>
                        <p>Examples of early and late binding:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span
                                    class="kn">import</span> <span class="n">Final</span>

<span class="kn">import</span> <span class="nn">lib</span>  <span class="c1"># &quot;lib&quot; is not compiled</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">y</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">()</span> <span class="o">-&gt;</span> <span
                                        class="kc">None</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Cls</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span
                                        class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span
                                        class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span
                                        class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span
                                        class="n">attr</span>

    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span
                                        class="p">)</span> <span class="o">-&gt;</span> <span
                                        class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">example</span><span class="p">()</span> <span class="o">-&gt;</span> <span
                                        class="kc">None</span><span class="p">:</span>
    <span class="c1"># Early binding:</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">func</span><span class="p">()</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">Cls</span><span class="p">()</span>
    <span class="n">o</span><span class="o">.</span><span class="n">x</span>
    <span class="n">o</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>

    <span class="c1"># Late binding:</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">x</span>  <span class="c1"># Module-level variable</span>
    <span class="n">lib</span><span class="o">.</span><span class="n">func</span><span class="p">()</span>  <span
                                        class="c1"># Accessing library that is not compiled</span>
</pre>
                            </div>
                        </div>
                    </section>
                    <section id="monkey-patching">
                        <h2>Monkey patching<a class="headerlink" href="#monkey-patching"
                                              title="Permalink to this heading">¶</a></h2>
                        <p>Since mypyc function and class definitions are immutable, you can’t
                            perform arbitrary monkey patching, such as replacing functions or
                            methods with mocks in tests.</p>
                        <div class="admonition note">
                            <p class="admonition-title">Note</p>
                            <p>Each compiled module has a Python namespace that is initialized to
                                point to compiled functions and type objects. This namespace is a
                                regular <code class="docutils literal notranslate"><span class="pre">dict</span></code>
                                object, and it <em>can</em> be modified. However,
                                compiled code generally doesn’t use this namespace, so any changes
                                will only be visible to non-compiled code.</p>
                        </div>
                    </section>
                    <section id="stack-overflows">
                        <h2>Stack overflows<a class="headerlink" href="#stack-overflows"
                                              title="Permalink to this heading">¶</a></h2>
                        <p>Compiled code currently doesn’t check for stack overflows. Your
                            program may crash in an unrecoverable fashion if you have too many
                            nested function calls, typically due to out-of-control recursion.</p>
                        <div class="admonition note">
                            <p class="admonition-title">Note</p>
                            <p>This limitation will be fixed in the future.</p>
                        </div>
                    </section>
                    <section id="final-values">
                        <h2>Final values<a class="headerlink" href="#final-values"
                                           title="Permalink to this heading">¶</a></h2>
                        <p>Compiled code replaces a reference to an attribute declared <code
                                class="docutils literal notranslate"><span class="pre">Final</span></code> with
                            the value of the attribute computed at compile time. This is an example of
                            <a class="reference internal" href="#early-binding"><span
                                    class="std std-ref">early binding</span></a>. Example:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="n">MAX</span><span class="p">:</span> <span
                                    class="n">Final</span> <span class="o">=</span> <span class="mi">100</span>

<span class="k">def</span> <span class="nf">limit_to_max</span><span class="p">(</span><span class="n">x</span><span
                                        class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span
                                        class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
     <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">MAX</span><span
                                        class="p">:</span>
         <span class="k">return</span> <span class="n">MAX</span>
     <span class="k">return</span> <span class="n">x</span>
</pre>
                            </div>
                        </div>
                        <p>The two references to <code class="docutils literal notranslate"><span class="pre">MAX</span></code>
                            don’t involve any module namespace lookups,
                            and are equivalent to this code:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">limit_to_max</span><span
                                    class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span
                                    class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span
                                    class="p">:</span>
     <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">100</span><span
                                        class="p">:</span>
         <span class="k">return</span> <span class="mi">100</span>
     <span class="k">return</span> <span class="n">x</span>
</pre>
                            </div>
                        </div>
                        <p>When run as interpreted, the first example will execute slower due to
                            the extra namespace lookups. In interpreted code final attributes can
                            also be modified.</p>
                    </section>
                    <section id="unsupported-features">
                        <h2>Unsupported features<a class="headerlink" href="#unsupported-features"
                                                   title="Permalink to this heading">¶</a></h2>
                        <p>Some Python features are not supported by mypyc (yet). They can’t be
                            used in compiled code, or there are some limitations. You can
                            partially work around some of these limitations by running your code
                            in interpreted mode.</p>
                        <section id="operator-overloading">
                            <h3>Operator overloading<a class="headerlink" href="#operator-overloading"
                                                       title="Permalink to this heading">¶</a></h3>
                            <p>Native classes can only use these dunder methods to override operators:</p>
                            <ul class="simple">
                                <li><p><code class="docutils literal notranslate"><span class="pre">__eq__</span></code>
                                </p></li>
                                <li><p><code class="docutils literal notranslate"><span class="pre">__ne__</span></code>
                                </p></li>
                                <li><p><code class="docutils literal notranslate"><span
                                        class="pre">__getitem__</span></code></p></li>
                                <li><p><code class="docutils literal notranslate"><span
                                        class="pre">__setitem__</span></code></p></li>
                            </ul>
                            <div class="admonition note">
                                <p class="admonition-title">Note</p>
                                <p>This limitation will be lifted in the future.</p>
                            </div>
                        </section>
                        <section id="generator-expressions">
                            <h3>Generator expressions<a class="headerlink" href="#generator-expressions"
                                                        title="Permalink to this heading">¶</a></h3>
                            <p>Generator expressions are not supported. To make it easier to compile
                                existing code, they are implicitly replaced with list comprehensions.
                                <em>This does not always produce the same behavior.</em></p>
                            <p>To work around this limitation, you can usually use a generator
                                function instead. You can sometimes replace the generator expression
                                with an explicit list comprehension.</p>
                        </section>
                        <section id="descriptors">
                            <h3>Descriptors<a class="headerlink" href="#descriptors"
                                              title="Permalink to this heading">¶</a></h3>
                            <p>Native classes can’t contain arbitrary descriptors. Properties, static
                                methods and class methods are supported.</p>
                        </section>
                        <section id="stack-introspection">
                            <h3>Stack introspection<a class="headerlink" href="#stack-introspection"
                                                      title="Permalink to this heading">¶</a></h3>
                            <p>Frames of compiled functions can’t be inspected using <code
                                    class="docutils literal notranslate"><span class="pre">inspect</span></code>.</p>
                        </section>
                        <section id="profiling-hooks-and-tracing">
                            <h3>Profiling hooks and tracing<a class="headerlink" href="#profiling-hooks-and-tracing"
                                                              title="Permalink to this heading">¶</a></h3>
                            <p>Compiled functions don’t trigger profiling and tracing hooks, such as
                                when using the <code class="docutils literal notranslate"><span
                                        class="pre">profile</span></code>, <code
                                        class="docutils literal notranslate"><span class="pre">cProfile</span></code>,
                                or <code class="docutils literal notranslate"><span class="pre">trace</span></code>
                                modules.</p>
                        </section>
                        <section id="debuggers">
                            <h3>Debuggers<a class="headerlink" href="#debuggers" title="Permalink to this heading">¶</a>
                            </h3>
                            <p>You can’t set breakpoints in compiled functions or step through
                                compiled functions using <code class="docutils literal notranslate"><span class="pre">pdb</span></code>.
                                Often you can debug your code in
                                interpreted mode instead.</p>
                        </section>
                    </section>
                </section>


            </div>

        </div>
    </div>
    <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <h1 class="logo"><a href="../../../../../index.html">Atbash</a></h1>


            <h3>Navigation</h3>

            <div class="relations">
                <h3>Related Topics</h3>
                <ul>
                    <li><a href="../../../../../index.html">Documentation overview</a>
                        <ul>
                        </ul>
                    </li>
                </ul>
            </div>
            <div id="searchbox" style="display: none" role="search">
                <h3 id="searchlabel">Quick search</h3>
                <div class="searchformwrapper">
                    <form class="search" action="../../../../../search.html" method="get">
                        <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off"
                               autocapitalize="off" spellcheck="false"/>
                        <input type="submit" value="Go"/>
                    </form>
                </div>
            </div>
            <script>document.getElementById('searchbox').style.display = "block"</script>


        </div>
    </div>
    <div class="clearer"></div>
</div>
<div class="footer">
    &copy;2022, Leor Fishman, Ben Simon, Kent Worcester, Prince Fefar.

    |
    Powered by <a href="http://sphinx-doc.org/">Sphinx 5.1.1</a>
    &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>

    |
    <a href="../../../../../_sources/venv/Lib/site-packages/mypyc/doc/differences_from_python.rst.txt"
       rel="nofollow">Page source</a>
</div>


</body>
</html>