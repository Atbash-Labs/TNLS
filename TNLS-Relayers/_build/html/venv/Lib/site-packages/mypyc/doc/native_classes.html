<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/"/>

    <title>Native classes &#8212; Atbash documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css"/>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/alabaster.css"/>
    <script data-url_root="../../../../../" id="documentation_options"
            src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html"/>
    <link rel="search" title="Search" href="../../../../../search.html"/>

    <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css"/>


    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9"/>

</head>
<body>


<div class="document">
    <div class="documentwrapper">
        <div class="bodywrapper">


            <div class="body" role="main">

                <section id="native-classes">
                    <span id="id1"></span>
                    <h1>Native classes<a class="headerlink" href="#native-classes"
                                         title="Permalink to this heading">¶</a></h1>
                    <p>Classes in compiled modules are <em>native classes</em> by default (some
                        exceptions are discussed below). Native classes are compiled to C
                        extension classes, which have some important differences from normal
                        Python classes. Native classes are similar in many ways to built-in
                        types, such as <code class="docutils literal notranslate"><span class="pre">int</span></code>,
                        <code class="docutils literal notranslate"><span class="pre">str</span></code>, and <code
                                class="docutils literal notranslate"><span class="pre">list</span></code>.</p>
                    <section id="immutable-namespaces">
                        <h2>Immutable namespaces<a class="headerlink" href="#immutable-namespaces"
                                                   title="Permalink to this heading">¶</a></h2>
                        <p>The type object namespace of native classes is mostly immutable (but
                            class variables can be assigned to):</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="k">class</span> <span
                                    class="nc">Cls</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">method1</span><span class="p">(</span><span class="bp">self</span><span
                                        class="p">)</span> <span class="o">-&gt;</span> <span
                                        class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;method1&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">method2</span><span class="p">(</span><span class="bp">self</span><span
                                        class="p">)</span> <span class="o">-&gt;</span> <span
                                        class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;method2&quot;</span><span class="p">)</span>

<span class="n">Cls</span><span class="o">.</span><span class="n">method1</span> <span class="o">=</span> <span
                                        class="n">Cls</span><span class="o">.</span><span
                                        class="n">method2</span>  <span class="c1"># Error</span>
<span class="n">Cls</span><span class="o">.</span><span class="n">new_method</span> <span class="o">=</span> <span
                                        class="n">Cls</span><span class="o">.</span><span
                                        class="n">method2</span>  <span class="c1"># Error</span>
</pre>
                            </div>
                        </div>
                        <p>Only attributes defined within a class definition (or in a base class)
                            can be assigned to (similar to using <code class="docutils literal notranslate"><span
                                    class="pre">__slots__</span></code>):</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="k">class</span> <span
                                    class="nc">Cls</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span
                                        class="p">,</span> <span class="n">y</span><span class="p">:</span> <span
                                        class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span
                                        class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span
                                        class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span
                                        class="n">y</span>

    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span
                                        class="p">)</span> <span class="o">-&gt;</span> <span
                                        class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span
                                        class="s2">&quot;x&quot;</span>

<span class="n">o</span> <span class="o">=</span> <span class="n">Cls</span><span class="p">(</span><span
                                        class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span
                                        class="n">x</span><span class="p">,</span> <span class="n">o</span><span
                                        class="o">.</span><span class="n">y</span><span class="p">)</span>  <span
                                        class="c1"># OK</span>
<span class="n">o</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>  <span
                                        class="c1"># OK</span>
<span class="n">o</span><span class="o">.</span><span class="n">extra</span> <span class="o">=</span> <span
                                        class="mi">3</span>  <span
                                        class="c1"># Error: no attribute &quot;extra&quot;</span>
</pre>
                            </div>
                        </div>
                    </section>
                    <section id="inheritance">
                        <span id="id2"></span>
                        <h2>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this heading">¶</a>
                        </h2>
                        <p>Only single inheritance is supported (except for <a class="reference internal"
                                                                               href="using_type_annotations.html#trait-types"><span
                                class="std std-ref">traits</span></a>). Most non-native classes can’t be used as base
                            classes.</p>
                        <p>These non-native classes can be used as base classes of native
                            classes:</p>
                        <ul class="simple">
                            <li><p><code class="docutils literal notranslate"><span class="pre">object</span></code></p>
                            </li>
                            <li><p><code class="docutils literal notranslate"><span class="pre">dict</span></code> (and
                                <code class="docutils literal notranslate"><span class="pre">Dict[k,</span> <span
                                        class="pre">v]</span></code>)</p></li>
                            <li><p><code class="docutils literal notranslate"><span
                                    class="pre">BaseException</span></code></p></li>
                            <li><p><code class="docutils literal notranslate"><span class="pre">Exception</span></code>
                            </p></li>
                            <li><p><code class="docutils literal notranslate"><span class="pre">ValueError</span></code>
                            </p></li>
                            <li><p><code class="docutils literal notranslate"><span class="pre">IndexError</span></code>
                            </p></li>
                            <li><p><code class="docutils literal notranslate"><span
                                    class="pre">LookupError</span></code></p></li>
                            <li><p><code class="docutils literal notranslate"><span
                                    class="pre">UserWarning</span></code></p></li>
                        </ul>
                        <p>By default, a non-native class can’t inherit a native class, and you
                            can’t inherit from a native class outside the compilation unit that
                            defines the class. You can enable these through
                            <code class="docutils literal notranslate"><span
                                    class="pre">mypy_extensions.mypyc_attr</span></code>:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mypy_extensions</span> <span
                                    class="kn">import</span> <span class="n">mypyc_attr</span>

<span class="nd">@mypyc_attr</span><span class="p">(</span><span class="n">allow_interpreted_subclasses</span><span
                                        class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Cls</span><span class="p">:</span>
    <span class="o">...</span>
</pre>
                            </div>
                        </div>
                        <p>Allowing interpreted subclasses has only minor impact on performance
                            of instances of the native class. Accessing methods and attributes of
                            a <em>non-native</em> subclass (or a subclass defined in another compilation
                            unit) will be slower, since it needs to use the normal Python
                            attribute access mechanism.</p>
                        <p>You need to install <code class="docutils literal notranslate"><span class="pre">mypy-extensions</span></code>
                            to use <code class="docutils literal notranslate"><span
                                    class="pre">&#64;mypyc_attr</span></code>:</p>
                        <div class="highlight-text notranslate">
                            <div class="highlight"><pre><span></span>pip install --upgrade mypy-extensions
</pre>
                            </div>
                        </div>
                    </section>
                    <section id="class-variables">
                        <h2>Class variables<a class="headerlink" href="#class-variables"
                                              title="Permalink to this heading">¶</a></h2>
                        <p>Class variables must be explicitly declared using <code class="docutils literal notranslate"><span
                                class="pre">attr:</span> <span class="pre">ClassVar</span></code>
                            or <code class="docutils literal notranslate"><span class="pre">attr:</span> <span
                                    class="pre">ClassVar[&lt;type&gt;]</span></code>. You can’t assign to a class
                            variable
                            through an instance. Example:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span
                                    class="kn">import</span> <span class="n">ClassVar</span>

<span class="k">class</span> <span class="nc">Cls</span><span class="p">:</span>
    <span class="n">cv</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span
                                        class="mi">0</span>

<span class="n">Cls</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span
                                        class="mi">2</span>  <span class="c1"># OK</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">Cls</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span
                                        class="n">cv</span><span class="p">)</span>  <span class="c1"># OK (2)</span>
<span class="n">o</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span
                                        class="mi">3</span>  <span class="c1"># Error!</span>
</pre>
                            </div>
                        </div>
                    </section>
                    <section id="generic-native-classes">
                        <h2>Generic native classes<a class="headerlink" href="#generic-native-classes"
                                                     title="Permalink to this heading">¶</a></h2>
                        <p>Native classes can be generic. Type variables are <em>erased</em> at runtime,
                            and instances don’t keep track of type variable values.</p>
                        <p>Compiled code thus can’t check the values of type variables when
                            performing runtime type checks. These checks are delayed to when
                            reading a value with a type variable type:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span
                                    class="kn">import</span> <span class="n">TypeVar</span><span
                                    class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span
                                    class="n">cast</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span
                                        class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Box</span><span class="p">(</span><span class="n">Generic</span><span
                                        class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span
                                        class="p">,</span> <span class="n">item</span><span class="p">:</span> <span
                                        class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span
                                        class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span
                                        class="n">item</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span
                                        class="mi">1</span><span class="p">)</span>  <span class="c1"># Box[int]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span
                                        class="n">Box</span><span class="p">[</span><span class="nb">str</span><span
                                        class="p">],</span> <span class="n">x</span><span class="p">)</span>  <span
                                        class="c1"># OK (type variable value not checked)</span>
<span class="n">y</span><span class="o">.</span><span class="n">item</span>  <span class="c1"># Runtime error: item is &quot;int&quot;, but &quot;str&quot; expected</span>
</pre>
                            </div>
                        </div>
                    </section>
                    <section id="metaclasses">
                        <h2>Metaclasses<a class="headerlink" href="#metaclasses" title="Permalink to this heading">¶</a>
                        </h2>
                        <p>Most metaclasses aren’t supported with native classes, since their
                            behavior is too dynamic. You can use these metaclasses, however:</p>
                        <ul class="simple">
                            <li><p><code class="docutils literal notranslate"><span
                                    class="pre">abc.ABCMeta</span></code></p></li>
                            <li><p><code class="docutils literal notranslate"><span
                                    class="pre">typing.GenericMeta</span></code> (used by <code
                                    class="docutils literal notranslate"><span class="pre">typing.Generic</span></code>)
                            </p></li>
                        </ul>
                        <div class="admonition note">
                            <p class="admonition-title">Note</p>
                            <p>If a class definition uses an unsupported metaclass, <em>mypyc
                                compiles the class into a regular Python class</em>.</p>
                        </div>
                    </section>
                    <section id="class-decorators">
                        <h2>Class decorators<a class="headerlink" href="#class-decorators"
                                               title="Permalink to this heading">¶</a></h2>
                        <p>Similar to metaclasses, most class decorators aren’t supported with
                            native classes, as they are usually too dynamic. These class
                            decorators can be used with native classes, however:</p>
                        <ul class="simple">
                            <li><p><code class="docutils literal notranslate"><span
                                    class="pre">mypy_extensions.trait</span></code> (for defining <a
                                    class="reference internal" href="using_type_annotations.html#trait-types"><span
                                    class="std std-ref">trait types</span></a>)</p></li>
                            <li><p><code class="docutils literal notranslate"><span class="pre">mypy_extensions.mypyc_attr</span></code>
                                (see <a class="reference internal" href="#inheritance"><span
                                        class="std std-ref">above</span></a>)</p></li>
                            <li><p><code class="docutils literal notranslate"><span
                                    class="pre">dataclasses.dataclass</span></code></p></li>
                        </ul>
                        <p>Dataclasses have partial native support, and they aren’t as efficient
                            as pure native classes.</p>
                        <div class="admonition note">
                            <p class="admonition-title">Note</p>
                            <p>If a class definition uses an unsupported class decorator, <em>mypyc
                                compiles the class into a regular Python class</em>.</p>
                        </div>
                    </section>
                    <section id="deleting-attributes">
                        <h2>Deleting attributes<a class="headerlink" href="#deleting-attributes"
                                                  title="Permalink to this heading">¶</a></h2>
                        <p>By default, attributes defined in native classes can’t be deleted. You
                            can explicitly allow certain attributes to be deleted by using
                            <code class="docutils literal notranslate"><span class="pre">__deletable__</span></code>:
                        </p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="k">class</span> <span
                                    class="nc">Cls</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span
                                        class="mi">0</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span
                                        class="mi">0</span>
    <span class="n">other</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span
                                        class="mi">0</span>

    <span class="n">__deletable__</span> <span class="o">=</span> <span class="p">[</span><span
                                        class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span
                                        class="p">]</span>  <span class="c1"># &#39;x&#39; and &#39;y&#39; can be deleted</span>

<span class="n">o</span> <span class="o">=</span> <span class="n">Cls</span><span class="p">()</span>
<span class="k">del</span> <span class="n">o</span><span class="o">.</span><span class="n">x</span>  <span class="c1"># OK</span>
<span class="k">del</span> <span class="n">o</span><span class="o">.</span><span class="n">y</span>  <span class="c1"># OK</span>
<span class="k">del</span> <span class="n">o</span><span class="o">.</span><span class="n">other</span>  <span
                                        class="c1"># Error</span>
</pre>
                            </div>
                        </div>
                        <p>You must initialize the <code class="docutils literal notranslate"><span class="pre">__deletable__</span></code>
                            attribute in the class body,
                            using a list or a tuple expression with only string literal items that
                            refer to attributes. These are not valid:</p>
                        <div class="highlight-default notranslate">
                            <div class="highlight"><pre><span></span><span class="n">a</span> <span
                                    class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span
                                    class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Cls</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">__deletable__</span> <span class="o">=</span> <span class="n">a</span>  <span class="c1"># Error: cannot use variable &#39;a&#39;</span>

<span class="n">__deletable__</span> <span class="o">=</span> <span class="p">(</span><span
                                        class="s1">&#39;a&#39;</span><span class="p">,)</span>  <span class="c1"># Error: not in a class body</span>
</pre>
                            </div>
                        </div>
                    </section>
                    <section id="other-properties">
                        <h2>Other properties<a class="headerlink" href="#other-properties"
                                               title="Permalink to this heading">¶</a></h2>
                        <p>Instances of native classes don’t usually have a <code
                                class="docutils literal notranslate"><span class="pre">__dict__</span></code> attribute.
                        </p>
                    </section>
                </section>


            </div>

        </div>
    </div>
    <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <h1 class="logo"><a href="../../../../../index.html">Atbash</a></h1>


            <h3>Navigation</h3>

            <div class="relations">
                <h3>Related Topics</h3>
                <ul>
                    <li><a href="../../../../../index.html">Documentation overview</a>
                        <ul>
                        </ul>
                    </li>
                </ul>
            </div>
            <div id="searchbox" style="display: none" role="search">
                <h3 id="searchlabel">Quick search</h3>
                <div class="searchformwrapper">
                    <form class="search" action="../../../../../search.html" method="get">
                        <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off"
                               autocapitalize="off" spellcheck="false"/>
                        <input type="submit" value="Go"/>
                    </form>
                </div>
            </div>
            <script>document.getElementById('searchbox').style.display = "block"</script>


        </div>
    </div>
    <div class="clearer"></div>
</div>
<div class="footer">
    &copy;2022, Leor Fishman, Ben Simon, Kent Worcester, Prince Fefar.

    |
    Powered by <a href="http://sphinx-doc.org/">Sphinx 5.1.1</a>
    &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>

    |
    <a href="../../../../../_sources/venv/Lib/site-packages/mypyc/doc/native_classes.rst.txt"
       rel="nofollow">Page source</a>
</div>


</body>
</html>